<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Devis de Projet - MZK Creation</title>
<link rel="icon" type="image/x-icon" href="favicon.ico">
<link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png">
<link rel="icon" type="image/svg+xml" href="favicon.svg">
<link rel="apple-touch-icon" href="apple-touch-icon.png">
<link rel="manifest" href="site.webmanifest"><link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Space+Mono:wght@400;700&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
:root{--black:#070707;--white:#f0ede6;--accent:#ff3c00;--gold:#ffd700;--gray:#111;--gray2:#1c1c1c;--muted:#666;--border:rgba(255,255,255,.07);}
*{margin:0;padding:0;box-sizing:border-box;}html{scroll-behavior:smooth;}
body{background:var(--black);color:var(--white);font-family:'DM Sans',sans-serif;overflow-x:hidden;cursor:none;}
#cur{width:10px;height:10px;background:var(--accent);border-radius:50%;position:fixed;top:0;left:0;pointer-events:none;z-index:9999;mix-blend-mode:difference;transition:transform .08s;}
#cur2{width:34px;height:34px;border:1px solid var(--accent);border-radius:50%;position:fixed;top:0;left:0;pointer-events:none;z-index:9998;mix-blend-mode:difference;transition:transform .14s ease;}
@media(hover:none),(pointer:coarse){body{cursor:auto;}#cur,#cur2{display:none;}}
body::after{content:'';position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='.033'/%3E%3C/svg%3E");pointer-events:none;z-index:0;}
.hero{min-height:100vh;display:grid;grid-template-rows:auto 1fr auto;position:relative;overflow:hidden;}
.hbg{position:absolute;inset:0;background:radial-gradient(ellipse 70% 55% at 85% 15%,rgba(255,60,0,.13) 0%,transparent 65%),radial-gradient(ellipse 45% 55% at 5% 85%,rgba(255,215,0,.05) 0%,transparent 55%);}
.gridl{position:absolute;inset:0;background-image:linear-gradient(rgba(255,60,0,.033) 1px,transparent 1px),linear-gradient(90deg,rgba(255,60,0,.033) 1px,transparent 1px);background-size:55px 55px;}
nav{position:relative;z-index:10;display:flex;justify-content:space-between;align-items:center;padding:2rem 3rem;border-bottom:1px solid var(--border);}
.logo{font-family:'Bebas Neue',sans-serif;font-size:1.9rem;letter-spacing:.08em;}
.logo em{color:var(--accent);font-style:normal;}
.nlinks{display:flex;gap:2.5rem;align-items:center;}
.nlinks a{color:var(--muted);text-decoration:none;font-family:'Space Mono',monospace;font-size:.72rem;letter-spacing:.15em;text-transform:uppercase;transition:color .2s;}
.nlinks a:hover{color:var(--accent);}
.ncta{background:var(--accent)!important;color:var(--black)!important;padding:.55rem 1.4rem;font-weight:700;clip-path:polygon(8px 0,100% 0,calc(100% - 8px) 100%,0 100%);}
.ncta:hover{background:var(--gold)!important;color:var(--black)!important;}
.hbody{position:relative;z-index:10;display:flex;flex-direction:column;justify-content:center;padding:4rem 3rem;}
.tag{font-family:'Space Mono',monospace;font-size:.72rem;color:var(--accent);letter-spacing:.3em;text-transform:uppercase;margin-bottom:1.5rem;display:flex;align-items:center;gap:.8rem;}
.tag::before{content:'';width:28px;height:1px;background:var(--accent);}
h1{font-family:'Bebas Neue',sans-serif;font-size:clamp(4.5rem,11vw,10rem);line-height:.88;letter-spacing:-.01em;margin-bottom:1.5rem;}
.ghost{-webkit-text-stroke:1px rgba(240,237,230,.22);color:transparent;display:block;}
.fire{color:var(--accent);}
.hsub{font-size:.95rem;color:var(--muted);max-width:480px;line-height:1.75;margin-bottom:3rem;font-weight:300;}
.acts{display:flex;gap:1.5rem;align-items:center;flex-wrap:wrap;}
.bmain{background:var(--accent);color:var(--black);padding:.95rem 2.4rem;font-family:'Space Mono',monospace;font-size:.75rem;font-weight:700;letter-spacing:.1em;text-transform:uppercase;border:none;clip-path:polygon(12px 0,100% 0,calc(100% - 12px) 100%,0 100%);cursor:pointer;transition:all .2s;text-decoration:none;display:inline-block;}
.bmain:hover{background:var(--gold);transform:translateY(-2px);}
.bghost{color:var(--white);font-family:'Space Mono',monospace;font-size:.72rem;letter-spacing:.1em;text-transform:uppercase;text-decoration:none;display:flex;align-items:center;gap:.5rem;transition:color .2s;}
.bghost:hover{color:var(--accent);}
.bghost::after{content:' ->';}
.hfoot{position:relative;z-index:10;padding:1.4rem 3rem;border-top:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:.5rem;}
.ticker{display:flex;gap:2rem;font-family:'Space Mono',monospace;font-size:.67rem;color:var(--muted);letter-spacing:.1em;text-transform:uppercase;}
.ticker .on{color:var(--accent);}
.avail{display:flex;align-items:center;gap:.5rem;font-family:'Space Mono',monospace;font-size:.67rem;color:var(--muted);}
.dot{width:6px;height:6px;background:#00e87a;border-radius:50%;animation:pulse 2s infinite;}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}
.sec{padding:6rem 3rem;position:relative;z-index:2;}
.slbl{font-family:'Space Mono',monospace;font-size:.68rem;color:var(--accent);letter-spacing:.28em;text-transform:uppercase;margin-bottom:3rem;display:flex;align-items:center;gap:1rem;}
.slbl::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,rgba(255,60,0,.35),transparent);}
.g2{display:grid;grid-template-columns:1fr 1fr;gap:1px;background:var(--border);border:1px solid var(--border);}
.bigcard{background:var(--black);padding:3rem;position:relative;overflow:hidden;transition:background .3s;}
.bigcard:hover{background:var(--gray);}
.bigcard::before{content:'';position:absolute;top:0;left:0;width:3px;height:0;background:var(--accent);transition:height .4s;}
.bigcard:hover::before{height:100%;}
.bc-n{font-family:'Bebas Neue',sans-serif;font-size:6rem;color:rgba(255,255,255,.03);position:absolute;top:.5rem;right:1.5rem;line-height:1;}
.bc-ico{font-size:2rem;margin-bottom:1.2rem;}
.bc-title{font-family:'Bebas Neue',sans-serif;font-size:2.4rem;letter-spacing:.04em;margin-bottom:.6rem;}
.bc-sub{font-size:.82rem;color:var(--muted);margin-bottom:1.5rem;font-weight:300;line-height:1.7;}
.bc-tags{display:flex;flex-wrap:wrap;gap:.5rem;}
.bc-tag{font-family:'Space Mono',monospace;font-size:.65rem;color:var(--muted);border:1px solid rgba(255,255,255,.1);padding:.3rem .7rem;transition:all .3s;}
.bigcard:hover .bc-tag{border-color:rgba(255,60,0,.3);color:var(--white);}
.csec{padding:6rem 3rem;border-top:1px solid var(--border);position:relative;z-index:2;}
.clay{display:grid;grid-template-columns:1fr 1.45fr;gap:5rem;align-items:start;}
.cintro h2{font-family:'Bebas Neue',sans-serif;font-size:clamp(3rem,5vw,4.5rem);line-height:.95;margin-bottom:1.5rem;}
.cintro h2 em{color:var(--accent);font-style:normal;}
.cintro p{color:var(--muted);line-height:1.8;font-size:.88rem;margin-bottom:2rem;font-weight:300;}
.steps{display:flex;flex-direction:column;gap:1.1rem;}
.step{display:flex;gap:1rem;align-items:flex-start;}
.sn{font-family:'Space Mono',monospace;font-size:.68rem;color:var(--accent);background:rgba(255,60,0,.1);border:1px solid rgba(255,60,0,.3);width:28px;height:28px;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.st{font-size:.83rem;color:var(--muted);padding-top:4px;font-weight:300;}
.st strong{color:var(--white);display:block;font-size:.88rem;margin-bottom:2px;}
.widget{background:var(--black);border:1px solid rgba(255,255,255,.1);display:flex;flex-direction:column;height:640px;clip-path:polygon(0 0,calc(100% - 20px) 0,100% 20px,100% 100%,20px 100%,0 calc(100% - 20px));}
.wh{padding:1.1rem 1.5rem;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:.8rem;background:rgba(255,60,0,.04);}
.av{width:32px;height:32px;background:var(--accent);display:flex;align-items:center;justify-content:center;font-family:'Bebas Neue',sans-serif;font-size:.85rem;color:var(--black);clip-path:polygon(4px 0,100% 0,calc(100% - 4px) 100%,0 100%);flex-shrink:0;}
.wi h4{font-family:'Space Mono',monospace;font-size:.72rem;font-weight:700;color:var(--white);}
.wi p{font-size:.62rem;color:var(--accent);font-family:'Space Mono',monospace;}
.msgs{flex:1;overflow-y:auto;padding:1.4rem;display:flex;flex-direction:column;gap:.9rem;scroll-behavior:smooth;}
.msgs::-webkit-scrollbar{width:3px;}
.msgs::-webkit-scrollbar-thumb{background:var(--accent);}
.msg{display:flex;gap:.7rem;align-items:flex-end;animation:msgIn .3s ease;}
@keyframes msgIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.msg.u{flex-direction:row-reverse;}
.bub{max-width:82%;padding:.75rem 1rem;font-size:.82rem;line-height:1.65;font-weight:300;}
.msg.b .bub{background:var(--gray2);color:var(--white);border-left:2px solid var(--accent);clip-path:polygon(0 0,100% 0,100% calc(100% - 7px),calc(100% - 7px) 100%,0 100%);}
.msg.u .bub{background:var(--accent);color:var(--black);font-weight:500;clip-path:polygon(7px 0,100% 0,100% 100%,0 100%,0 7px);}
.ico{width:22px;height:22px;border-radius:50%;background:var(--gray2);display:flex;align-items:center;justify-content:center;font-size:.65rem;flex-shrink:0;border:1px solid var(--border);}
.msg.b .ico{background:rgba(255,60,0,.2);border-color:var(--accent);}
.typing{display:flex;gap:4px;align-items:center;padding:.3rem 0;}
.typing span{width:5px;height:5px;background:var(--accent);border-radius:50%;animation:ty 1.2s infinite;}
.typing span:nth-child(2){animation-delay:.2s;}
.typing span:nth-child(3){animation-delay:.4s;}
@keyframes ty{0%,60%,100%{transform:translateY(0);opacity:.4}30%{transform:translateY(-6px);opacity:1}}
.win{padding:.9rem 1.2rem;border-top:1px solid var(--border);display:flex;gap:.7rem;align-items:center;}
.inp{flex:1;background:var(--gray2);border:1px solid var(--border);color:var(--white);padding:.75rem 1rem;font-family:'DM Sans',sans-serif;font-size:.83rem;outline:none;transition:border-color .2s;}
.inp::placeholder{color:var(--muted);}
.inp:focus{border-color:var(--accent);}
.snd{background:var(--accent);border:none;color:var(--black);width:40px;height:40px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:1.1rem;transition:background .2s;clip-path:polygon(6px 0,100% 0,calc(100% - 6px) 100%,0 100%);flex-shrink:0;}
.snd:hover{background:var(--gold);}
.snd:disabled{background:var(--gray2);cursor:not-allowed;}
footer{padding:1.8rem 3rem;border-top:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;position:relative;z-index:2;flex-wrap:wrap;gap:1rem;}
footer p{font-family:'Space Mono',monospace;font-size:.62rem;color:var(--muted);}
.flinks a{font-family:'Space Mono',monospace;font-size:.62rem;color:var(--muted);text-decoration:none;transition:color .2s;}
.flinks a:hover{color:var(--accent);}
.ov{position:fixed;inset:0;background:rgba(0,0,0,.9);z-index:1000;display:flex;align-items:center;justify-content:center;padding:2rem;backdrop-filter:blur(10px);opacity:0;pointer-events:none;transition:opacity .3s;}
.ov.on{opacity:1;pointer-events:all;}
.modal{background:var(--black);border:1px solid rgba(255,255,255,.1);max-width:640px;width:100%;max-height:90vh;overflow-y:auto;clip-path:polygon(0 0,calc(100% - 22px) 0,100% 22px,100% 100%,22px 100%,0 calc(100% - 22px));transform:translateY(16px);transition:transform .3s;}
.ov.on .modal{transform:translateY(0);}
.mh{padding:1.8rem 2rem;border-bottom:1px solid var(--border);background:rgba(255,60,0,.04);display:flex;justify-content:space-between;align-items:center;}
.mh h3{font-family:'Bebas Neue',sans-serif;font-size:1.9rem;letter-spacing:.05em;}
.mh h3 em{color:var(--accent);font-style:normal;}
.mc{background:none;border:1px solid var(--border);color:var(--white);width:30px;height:30px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;font-size:.9rem;}
.mc:hover{border-color:var(--accent);color:var(--accent);}
.mb{padding:1.8rem 2rem;}
.ds{margin-bottom:1.5rem;}
.ds h4{font-family:'Space Mono',monospace;font-size:.67rem;color:var(--accent);letter-spacing:.15em;text-transform:uppercase;margin-bottom:.8rem;padding-bottom:.4rem;border-bottom:1px solid rgba(255,60,0,.18);}
.dr{display:flex;justify-content:space-between;align-items:baseline;padding:.42rem 0;font-size:.82rem;border-bottom:1px solid rgba(255,255,255,.03);}
.dr .l{color:var(--muted);font-weight:300;flex-shrink:0;}
.dr .v{color:var(--white);font-family:'Space Mono',monospace;font-size:.75rem;text-align:right;max-width:60%;}
.dr .p{color:var(--accent);font-family:'Space Mono',monospace;font-size:.75rem;font-style:italic;}
.dtot{background:rgba(255,60,0,.07);border:1px solid rgba(255,60,0,.2);padding:1rem 1.4rem;display:flex;justify-content:space-between;align-items:center;margin-top:1rem;}
.dtot .tl{font-family:'Bebas Neue',sans-serif;font-size:1.15rem;}
.dtot .tv{font-family:'Space Mono',monospace;color:var(--accent);font-size:.85rem;font-style:italic;}
.dn{font-family:'Space Mono',monospace;font-size:.62rem;color:var(--muted);line-height:1.65;margin-top:1rem;padding:.75rem;border-left:2px solid rgba(255,60,0,.25);}
.ma{display:flex;gap:1rem;padding:0 2rem 1.8rem;flex-wrap:wrap;}
.bpdf,.bmail{padding:.85rem 1.8rem;font-family:'Space Mono',monospace;font-size:.72rem;font-weight:700;letter-spacing:.08em;cursor:pointer;transition:all .2s;clip-path:polygon(8px 0,100% 0,calc(100% - 8px) 100%,0 100%);border:none;}
.bpdf{background:var(--accent);color:var(--black);}
.bpdf:hover{background:var(--gold);}
.bmail{background:transparent;color:var(--white);border:1px solid var(--border);clip-path:none;}
.bmail:hover{border-color:var(--accent);color:var(--accent);}
.notif{position:fixed;bottom:2rem;right:2rem;background:var(--gray2);border:1px solid var(--accent);color:var(--white);padding:1rem 1.5rem;font-family:'Space Mono',monospace;font-size:.72rem;z-index:2000;clip-path:polygon(0 0,calc(100% - 10px) 0,100% 10px,100% 100%,10px 100%,0 calc(100% - 10px));transform:translateX(200%);transition:transform .4s ease;max-width:320px;line-height:1.5;}
.notif.show{transform:translateX(0);}
@media(max-width:900px){
  nav,.hbody,.hfoot,.sec,.csec{padding-left:1.5rem;padding-right:1.5rem;}
  .g2,.clay{grid-template-columns:1fr;}
  .clay{gap:3rem;}
  footer{padding:1.5rem;flex-direction:column;text-align:center;}
  .widget{height:560px;}
  .nlinks .h{display:none;}
}
</style>
</head>
<body>
<div id="cur"></div>
<div id="cur2"></div>

<section class="hero">
  <div class="hbg"></div><div class="gridl"></div>
  <nav>
    <div class="logo">MZK<em>.</em>Creation</div>
    <div class="nlinks">
      <a href="https://mzk-creation.fr" target="_blank" class="h">Portfolio</a>
      <a href="#services" class="h">Services</a>
      <a href="#contact" class="ncta">Mon projet</a>
    </div>
  </nav>
  <div class="hbody">
    <div class="tag">Videaste . Post-Production . IA</div>
    <h1>RAW<br><span class="ghost">TO</span><span class="fire">RENDERED</span></h1>
    <p class="hsub">Du tournage brut a la livraison finale. Motion design, VFX, 3D, animation, IA generative. Chaque projet traite avec une exigence technique et creative sans compromis.</p>
    <div class="acts">
      <a href="#contact" class="bmain">Deposer mon projet</a>
      <a href="https://mzk-creation.fr" target="_blank" class="bghost">Voir le portfolio</a>
    </div>
  </div>
  <div class="hfoot">
    <div class="ticker">
      <span class="on">TOURNAGE</span><span>ETALONNAGE</span><span>MOTION DESIGN</span><span>VFX</span><span>3D</span><span>IA GENERATIVE</span>
    </div>
    <div class="avail"><span class="dot"></span>Disponible pour nouveaux projets</div>
  </div>
</section>

<section class="sec" id="services">
  <div class="slbl">/ Prestations</div>
  <div class="g2">
    <div class="bigcard">
      <div class="bc-n">01</div>
      <div class="bc-ico">&#127916;</div>
      <div class="bc-title">Tournage</div>
      <p class="bc-sub">Captation professionnelle sur le terrain, en studio ou en deplacement. Equipement video complet, eclairage et son.</p>
      <div class="bc-tags">
        <span class="bc-tag">Equipement video pro</span>
        <span class="bc-tag">Eclairage</span>
        <span class="bc-tag">Son sans fil</span>
        <span class="bc-tag">Fond vert</span>
        <span class="bc-tag">360</span>
        <span class="bc-tag">Deplacements France</span>
      </div>
    </div>
    <div class="bigcard">
      <div class="bc-n">02</div>
      <div class="bc-ico">&#128421;</div>
      <div class="bc-title">Post-Production</div>
      <p class="bc-sub">De la timeline au rendu final. Montage, etalonnage, effets visuels et intelligence artificielle sur station M2.</p>
      <div class="bc-tags">
        <span class="bc-tag">Montage</span>
        <span class="bc-tag">Etalonnage</span>
        <span class="bc-tag">Motion Design</span>
        <span class="bc-tag">VFX</span>
        <span class="bc-tag">3D</span>
        <span class="bc-tag">Animation</span>
        <span class="bc-tag">IA Generative</span>
        <span class="bc-tag">Sous-titres</span>
      </div>
    </div>
  </div>
</section>

<section class="csec" id="contact">
  <div class="clay">
    <div class="cintro">
      <div class="slbl">/ Votre projet</div>
      <h2>PARLEZ-MOI DE<br>VOTRE <em>PROJET</em></h2>
      <p>Discutez directement avec mon assistant IA. Il comprend votre besoin, pose les bonnes questions et genere un brief complet pour Sofiane.</p>
      <div class="steps">
        <div class="step"><div class="sn">1</div><div class="st"><strong>Decrivez votre projet</strong>L'IA pose les questions adaptees</div></div>
        <div class="step"><div class="sn">2</div><div class="st"><strong>Brief genere automatiquement</strong>Tournage, post-prod, format, budget</div></div>
        <div class="step"><div class="sn">3</div><div class="st"><strong>PDF + email envoye a Sofiane</strong>Il revient rapidement avec un devis</div></div>
      </div>
    </div>
    <div class="widget">
      <div class="wh">
        <div class="av">MZK</div>
        <div class="wi"><h4>Assistant MZK Creation</h4><p>&#9679; Powered by Groq AI</p></div>
      </div>
      <div class="msgs" id="msgs"></div>
      <div class="win">
        <input type="text" class="inp" id="inp" placeholder="Votre message..." />
        <button class="snd" id="snd">&#8593;</button>
      </div>
    </div>
  </div>
</section>

<footer>
  <div style="font-family:'Bebas Neue',sans-serif;font-size:1.5rem;letter-spacing:.08em;">MZK<em style="color:var(--accent);font-style:normal">.</em>Creation</div>
  <p>Auto-Entrepreneur . Sofiane . sofiane.crea@gmail.com</p>
  <div class="flinks"><a href="https://mzk-creation.fr" target="_blank">Portfolio</a></div>
</footer>

<div class="ov" id="ov">
  <div class="modal">
    <div class="mh"><h3>DEVIS <em>PRELIMINAIRE</em></h3><button class="mc" id="closeBtn">X</button></div>
    <div class="mb" id="mb"></div>
    <div class="ma">
      <button class="bpdf" id="pdfBtn">Telecharger PDF</button>
      <button class="bmail" id="mailClientBtn">Email au client</button>
      <button class="bmail" id="mailSofianeBtn" style="background:rgba(255,60,0,.1);border-color:rgba(255,60,0,.4);color:var(--accent);">Envoyer a Sofiane</button>
    </div>
  </div>
</div>
<div class="notif" id="notif"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
<script>
(function(){
  emailjs.init('u6CM1lxeP5MJgqr0j');
  // CURSOR
  var cu = document.getElementById('cur');
  var cu2 = document.getElementById('cur2');
  document.addEventListener('mousemove', function(e) {
    cu.style.transform = 'translate(' + (e.clientX - 5) + 'px,' + (e.clientY - 5) + 'px)';
    setTimeout(function() {
      cu2.style.transform = 'translate(' + (e.clientX - 17) + 'px,' + (e.clientY - 17) + 'px)';
    }, 80);
  });

  // TICKER
  var tks = document.querySelectorAll('.ticker span'), ti = 0;
  setInterval(function() {
    tks.forEach(function(t) { t.classList.remove('on'); });
    ti = (ti + 1) % tks.length;
    tks[ti].classList.add('on');
  }, 1800);

  // CONFIG
  var GROQ_KEY = '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';
  var GROQ_URL = 'https://api.groq.com/openai/v1/chat/completions';
  var MAIL = 'sofiane.crea@gmail.com';
  var REF = 'MZK-' + Date.now().toString().slice(-6);

  var msgsEl = document.getElementById('msgs');
  var inpEl = document.getElementById('inp');
  var sndEl = document.getElementById('snd');
  var history = [];
  var brief = {};
  var convDone = false;

  var SYSTEM_PROMPT = "Tu es l'assistant commercial de MZK Creation. Ton seul role : collecter des infos pour un brief projet. REGLES STRICTES : 1) Pose UNE seule question a la fois, tres courte (1 phrase max). 2) Si le client repond autre chose qu'une reponse a ta question, reponds uniquement : 'Merci de repondre a la question : [repete la question]'. 3) Aucun commentaire, aucune phrase de remplissage, aucune explication. Juste la question suivante. 4) Jamais plus de 2 phrases dans ta reponse. Collecte dans cet ordre : 1.Nom et prenom 2.Telephone 3.Email 4.Societe ou Particulier 5.Description du projet (contexte, objectif, public, ton) 6.Type prestation: Tournage / Post-production / Les deux 7.Si tournage: type captation, lieu, nb jours 8.Si post-prod: sous-prestations parmi Montage, Etalonnage, Motion Design, VFX, 3D, Animation, IA Generative, Sous-titres 9.Si post-prod: format rushes S-Log RAW ou REC709 10.Ratio 16:9 ou 9:16 ou 1:1 11.Qualite 1080p ou 4K ou 6K 12.Plateformes de diffusion 13.Duree contenu 14.Deadline 15.Budget parmi: -100EUR / 100-300 / 300-500 / 500-1500 / 1500-3000 / 3000-5000 / 5000+ / A negocier 16.References visuelles 17.Infos complementaires. Quand tout est collecte, ecris [BRIEF_COMPLET] puis un JSON sur une ligne avec: nom, telephone, email, societe, projet, type_presta, details_tournage, lieu, nb_jours, sous_prestations, format_source, ratio, qualite, diffusion, duree, deadline, budget, refs, extra. Reponds toujours en francais. Si le message est 'START', reponds uniquement : 'Votre nom et prenom ?'";

  function sleep(ms) { return new Promise(function(r) { setTimeout(r, ms); }); }

  function addMsg(text, who) {
    var d = document.createElement('div');
    d.className = 'msg ' + who;
    var clean = text.split('**').map(function(s,i){return i%2===1?'<strong>'+s+'</strong>':s;}).join('').split('\n').join('<br>');
    if (who === 'b') {
      d.innerHTML = '<div class="ico">&#129302;</div><div class="bub">' + clean + '</div>';
    } else {
      d.innerHTML = '<div class="bub">' + clean + '</div><div class="ico">&#128100;</div>';
    }
    msgsEl.appendChild(d);
    msgsEl.scrollTop = msgsEl.scrollHeight;
  }

  function showTyping() {
    var d = document.createElement('div');
    d.className = 'msg b'; d.id = 'typing-indicator';
    d.innerHTML = '<div class="ico">&#129302;</div><div class="bub"><div class="typing"><span></span><span></span><span></span></div></div>';
    msgsEl.appendChild(d);
    msgsEl.scrollTop = msgsEl.scrollHeight;
  }

  function hideTyping() {
    var t = document.getElementById('typing-indicator');
    if (t) t.remove();
  }

  async function callGroq(userMsg) {
    history.push({ role: 'user', content: userMsg });
    var payload = {
      model: 'llama-3.3-70b-versatile',
      messages: [{ role: 'system', content: SYSTEM_PROMPT }].concat(history),
      temperature: 0.7,
      max_tokens: 500
    };
    try {
      var res = await fetch(GROQ_URL, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ' + GROQ_KEY
        },
        body: JSON.stringify(payload)
      });
      var data = await res.json();
      if (data.error) throw new Error(data.error.message);
      var reply = data.choices[0].message.content;
      history.push({ role: 'assistant', content: reply });
      return reply;
    } catch(e) {
      return 'Desolee, une erreur est survenue. Veuillez reessayer. (' + e.message + ')';
    }
  }

  function parseBrief(text) {
    var match = text.match(/\[BRIEF_COMPLET\][\s\S]*?(\{[\s\S]*\})/);
    if (match) {
      try {
        brief = JSON.parse(match[1]);
        return true;
      } catch(e) {}
    }
    return false;
  }

  async function sendMessage(userMsg) {
    if (!userMsg.trim() || convDone) return;
    inpEl.value = '';
    sndEl.disabled = true;
    addMsg(userMsg, 'u');
    showTyping();
    var reply = await callGroq(userMsg);
    hideTyping();

    if (parseBrief(reply)) {
      convDone = true;
      var visibleReply = reply.replace(/\[BRIEF_COMPLET\][\s\S]*/, '').trim();
      if (!visibleReply) visibleReply = 'Parfait, votre brief est complet. Sofiane revient vers vous rapidement.';
      addMsg(visibleReply, 'b');
      await sleep(600);
      showDevisBtn();
    } else {
      addMsg(reply, 'b');
      sndEl.disabled = false;
      inpEl.focus();
    }
  }

  function showDevisBtn() {
    var d = document.createElement('div');
    d.className = 'msg b';
    d.innerHTML = '<div class="ico">&#129302;</div><div class="bub" style="background:transparent;border:none;padding:0;display:flex;flex-direction:column;gap:.6rem">' +
      '<button class="bmain" id="devisBtn" style="font-size:.72rem;padding:.8rem 1.4rem;border:none;cursor:pointer;">Voir mon devis preliminaire</button>' +
      '<button id="newProjetBtn" style="font-size:.68rem;padding:.65rem 1.2rem;font-family:Space Mono,monospace;letter-spacing:.08em;background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,.1);cursor:pointer;transition:all .2s;">+ Nouveau projet</button>' +
      '</div>';
    msgsEl.appendChild(d);
    msgsEl.scrollTop = msgsEl.scrollHeight;
    document.getElementById('devisBtn').onclick = showDevis;
    document.getElementById('newProjetBtn').onclick = resetConv;
    document.getElementById('newProjetBtn').onmouseover = function(){ this.style.borderColor='var(--accent)'; this.style.color='var(--white)'; };
    document.getElementById('newProjetBtn').onmouseout = function(){ this.style.borderColor='rgba(255,255,255,.1)'; this.style.color='var(--muted)'; };
  }

  function resetConv() {
    history = [];
    brief = {};
    convDone = false;
    REF = 'MZK-' + Date.now().toString().slice(-6);
    msgsEl.innerHTML = '';
    inpEl.value = '';
    sndEl.disabled = false;
    (async function() {
      await sleep(300);
      showTyping();
      var intro = await callGroq('START');
      hideTyping();
      addMsg(intro, 'b');
      inpEl.focus();
    })();
  }

  // INIT
  (async function() {
    await sleep(500);
    showTyping();
    var intro = await callGroq('START');
    hideTyping();
    addMsg(intro, 'b');
    inpEl.focus();
  })();

  sndEl.onclick = function() { sendMessage(inpEl.value); };
  inpEl.addEventListener('keydown', function(e) { if (e.key === 'Enter') sendMessage(inpEl.value); });

  // DEVIS MODAL
  function showDevis() {
    var tp = (brief.type_presta || '').toLowerCase();
    var sp = brief.sous_prestations || '';
    var pLines = '';
    if (tp.indexOf('tournage') > -1) {
      pLines += '<div class="dr"><span class="l">Tournage</span><span class="p">A tarifer</span></div>';
      if (brief.nb_jours) pLines += '<div class="dr"><span class="l">Duree</span><span class="v">' + brief.nb_jours + '</span></div>';
      if (brief.lieu) pLines += '<div class="dr"><span class="l">Lieu</span><span class="v">' + brief.lieu + '</span></div>';
    }
    if (tp.indexOf('post') > -1 || tp.indexOf('deux') > -1 || tp.indexOf('production') > -1) {
      (sp || 'Post-production').split(/,|\//).map(function(s){ return s.trim(); }).filter(Boolean).forEach(function(s) {
        pLines += '<div class="dr"><span class="l">' + s + '</span><span class="p">A tarifer</span></div>';
      });
      if (brief.format_source) pLines += '<div class="dr"><span class="l">Format rushes</span><span class="v">' + brief.format_source + '</span></div>';
    }
    var date = new Date().toLocaleDateString('fr-FR');
    document.getElementById('mb').innerHTML =
      '<div class="ds"><h4>Client</h4>' +
      '<div class="dr"><span class="l">Nom</span><span class="v">' + (brief.nom||'—') + '</span></div>' +
      '<div class="dr"><span class="l">Telephone</span><span class="v">' + (brief.telephone||'—') + '</span></div>' +
      '<div class="dr"><span class="l">Email</span><span class="v">' + (brief.email||'—') + '</span></div>' +
      '<div class="dr"><span class="l">Societe</span><span class="v">' + (brief.societe||'Particulier') + '</span></div></div>' +
      '<div class="ds"><h4>Projet</h4>' +
      '<div class="dr" style="flex-direction:column;align-items:flex-start;gap:.3rem;border:none"><span class="l">Description</span><span class="v" style="font-family:sans-serif;max-width:100%;text-align:left;margin-top:.2rem;line-height:1.5">' + (brief.projet||'—') + '</span></div>' +
      '<div class="dr"><span class="l">Prestation</span><span class="v">' + (brief.type_presta||'—') + '</span></div>' +
      (brief.details_tournage ? '<div class="dr"><span class="l">Details tournage</span><span class="v">'+brief.details_tournage+'</span></div>' : '') +
      (brief.sources ? '<div class="dr"><span class="l">Fichiers sources</span><span class="v">'+brief.sources+'</span></div>' : '') +
      '<div class="dr"><span class="l">Ratio</span><span class="v">' + (brief.ratio||'—') + '</span></div>' +
      '<div class="dr"><span class="l">Qualite</span><span class="v">' + (brief.qualite||'—') + '</span></div>' +
      '<div class="dr"><span class="l">Diffusion</span><span class="v">' + (brief.diffusion||'—') + '</span></div>' +
      '<div class="dr"><span class="l">Duree</span><span class="v">' + (brief.duree||'—') + '</span></div>' +
      '<div class="dr"><span class="l">Deadline</span><span class="v">' + (brief.deadline||'—') + '</span></div>' +
      '<div class="dr"><span class="l">Budget</span><span class="v" style="color:var(--gold)">' + (brief.budget||'—') + '</span></div>' +
      (brief.refs ? '<div class="dr"><span class="l">References</span><span class="v">'+brief.refs+'</span></div>' : '') +
      (brief.extra ? '<div class="dr"><span class="l">Infos sup.</span><span class="v">'+brief.extra+'</span></div>' : '') +
      '</div>' +
      '<div class="ds"><h4>Prestations demandees</h4>' + pLines + '</div>' +
      '<div class="dtot"><span class="tl">TOTAL ESTIME HT</span><span class="tv">A definir par Sofiane</span></div>' +
      '<div class="dn">Devis preliminaire non contractuel. Ref. ' + REF + ' — ' + date + '</div>';
    document.getElementById('ov').classList.add('on');
  }

  document.getElementById('closeBtn').onclick = function() {
    document.getElementById('ov').classList.remove('on');
  };

  document.getElementById('pdfBtn').onclick = function() {
    var jsPDF = window.jspdf.jsPDF;
    var doc = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });
    var BG=[7,7,7], W=[240,237,230], A=[255,60,0], MU=[100,100,100], G=[255,215,0];
    doc.setFillColor(BG[0],BG[1],BG[2]); doc.rect(0,0,210,297,'F');
    doc.setFillColor(A[0],A[1],A[2]); doc.rect(0,0,210,2,'F');
    doc.setFont('helvetica','bold'); doc.setFontSize(22); doc.setTextColor(W[0],W[1],W[2]);
    doc.text('MZK CREATION', 20, 20);
    doc.setFontSize(7.5); doc.setFont('helvetica','normal'); doc.setTextColor(MU[0],MU[1],MU[2]);
    doc.text('DEVIS PRELIMINAIRE NON CONTRACTUEL', 20, 28);
    doc.text('Ref. ' + REF + ' — ' + new Date().toLocaleDateString('fr-FR'), 20, 34);
    doc.setFillColor(A[0],A[1],A[2]); doc.rect(0,40,210,.5,'F');
    var y = 50;
    function sec(t) { doc.setFont('helvetica','bold'); doc.setFontSize(7); doc.setTextColor(A[0],A[1],A[2]); doc.text(t,20,y); y+=5; doc.setFont('helvetica','normal'); doc.setFontSize(8.5); }
    function row(l,v,rc,gc,bc) { if(!v)return; doc.setTextColor(MU[0],MU[1],MU[2]); doc.text(l,22,y); doc.setTextColor(rc||W[0],gc||W[1],bc||W[2]); var ln=doc.splitTextToSize(String(v),100); doc.text(ln,80,y); y+=ln.length*5+2; }
    sec('CLIENT');
    row('Nom', brief.nom); row('Telephone', brief.telephone); row('Email', brief.email); row('Societe', brief.societe||'Particulier'); y+=3;
    sec('PROJET');
    row('Description', brief.projet); row('Prestation', brief.type_presta);
    if(brief.details_tournage) row('Details tournage', brief.details_tournage);
    if(brief.format_source) row('Format rushes', brief.format_source);
    row('Ratio', brief.ratio); row('Qualite', brief.qualite); row('Diffusion', brief.diffusion);
    row('Duree', brief.duree); row('Deadline', brief.deadline);
    row('Budget', brief.budget, G[0],G[1],G[2]);
    if(brief.refs) row('References', brief.refs);
    if(brief.extra) row('Infos sup.', brief.extra);
    y+=3;
    sec('PRESTATIONS');
    var tp2 = (brief.type_presta||'').toLowerCase();
    if(tp2.indexOf('tournage')>-1) { doc.setFillColor(20,20,20); doc.rect(20,y-3.5,170,6,'F'); doc.setTextColor(W[0],W[1],W[2]); doc.text('Tournage'+(brief.nb_jours?' ('+brief.nb_jours+')':''),23,y); doc.setTextColor(A[0],A[1],A[2]); doc.text('A tarifer',165,y); y+=7; }
    if(tp2.indexOf('post')>-1||tp2.indexOf('deux')>-1||tp2.indexOf('production')>-1) {
      (brief.sous_prestations||'Post-production').split(/,|\//).map(function(s){return s.trim();}).filter(Boolean).forEach(function(s){ doc.setFillColor(20,20,20); doc.rect(20,y-3.5,170,6,'F'); doc.setTextColor(W[0],W[1],W[2]); doc.text(s,23,y); doc.setTextColor(A[0],A[1],A[2]); doc.text('A tarifer',165,y); y+=7; });
    }
    y+=6;
    doc.setFillColor(30,8,4); doc.rect(20,y-5,170,12,'F');
    doc.setDrawColor(A[0],A[1],A[2]); doc.rect(20,y-5,170,12,'S');
    doc.setFont('helvetica','bold'); doc.setFontSize(10); doc.setTextColor(W[0],W[1],W[2]); doc.text('TOTAL ESTIME HT',24,y+2);
    doc.setFontSize(8); doc.setTextColor(A[0],A[1],A[2]); doc.text('A definir par Sofiane',142,y+2);
    y+=18;
    doc.setFont('helvetica','italic'); doc.setFontSize(7); doc.setTextColor(MU[0],MU[1],MU[2]);
    doc.text('Devis preliminaire non contractuel. MZK Creation — sofiane.crea@gmail.com', 20, y);
    doc.setFillColor(A[0],A[1],A[2]); doc.rect(0,292,210,2,'F');
    doc.save('Devis-' + REF + '.pdf');
    notify('PDF telecharge !');
  };

  // EMAIL CLIENT via EmailJS
  document.getElementById('mailClientBtn').onclick = async function() {
    var btn = document.getElementById('mailClientBtn');
    btn.textContent = 'Envoi...';
    btn.disabled = true;
    try {
      await emailjs.send('service_drxsh2d', 'template_5cpc9y2', {
        ref: REF,
        date: new Date().toLocaleDateString('fr-FR'),
        client_prenom: (brief.nom||'').split(' ')[0],
        client_nom: brief.nom||'—',
        client_email: brief.email||'—',
        client_telephone: brief.telephone||'—',
        client_societe: brief.societe||'Particulier',
        projet_description: brief.projet||'—',
        projet_type: brief.type_presta||'—',
        projet_ratio: brief.ratio||'—',
        projet_qualite: brief.qualite||'—',
        projet_diffusion: brief.diffusion||'—',
        projet_duree: brief.duree||'—',
        projet_deadline: brief.deadline||'—'
      });
      notify('Email envoye au client !');
    } catch(e) {
      notify('Erreur envoi client : ' + e.text);
    }
    btn.textContent = 'Email au client';
    btn.disabled = false;
  };

  // EMAIL SOFIANE via EmailJS + estimation IA
  document.getElementById('mailSofianeBtn').onclick = async function() {
    var btn = document.getElementById('mailSofianeBtn');
    btn.textContent = 'Calcul IA...';
    btn.disabled = true;

    // Appel IA pour estimation
    var promptEstim = 'Tu es un expert en tarification video/post-production. Voici un brief client :\n' +
      'Projet : ' + (brief.projet||'—') + '\n' +
      'Prestation : ' + (brief.type_presta||'—') + '\n' +
      (brief.details_tournage ? 'Details tournage : ' + brief.details_tournage + '\n' : '') +
      (brief.lieu ? 'Lieu : ' + brief.lieu + '\n' : '') +
      (brief.nb_jours ? 'Nb jours tournage : ' + brief.nb_jours + '\n' : '') +
      (brief.sous_prestations ? 'Post-prod : ' + brief.sous_prestations + '\n' : '') +
      'Ratio : ' + (brief.ratio||'—') + '\n' +
      'Qualite : ' + (brief.qualite||'—') + '\n' +
      'Duree contenu : ' + (brief.duree||'—') + '\n' +
      'Deadline : ' + (brief.deadline||'—') + '\n' +
      'Budget annonce par le client : ' + (brief.budget||'—') + '\n\n' +
      'Tarifs : Tournage = 800 EUR/jour (100 EUR/h). Post-production = 400 EUR/jour (50 EUR/h). Tarifs pouvant etre revus a la baisse.\n\n' +
      'Reponds en francais avec ce format exact (rien d\'autre) :\n' +
      'ESTIMATION_TOURNAGE: X EUR (Y jours)\n' +
      'ESTIMATION_POSTPROD: X EUR (Y jours)\n' +
      'TOTAL_ESTIME: X EUR\n' +
      'COMPLEXITE: Simple ou Moyenne ou Elevee\n' +
      'VERDICT: honnete ou trop_bas ou correct\n' +
      'ANALYSE_BUDGET: [2-3 phrases directes sur le budget]\n' +
      'RECOMMANDATION: [1 phrase sur comment negocier]';

    var estim = { tournage:'—', postprod:'—', total:'—', complexite:'—', analyse:'—', reco:'—', verdict:'correct' };
    try {
      var res = await fetch(GROQ_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + GROQ_KEY },
        body: JSON.stringify({ model:'llama-3.3-70b-versatile', messages:[{role:'user',content:promptEstim}], temperature:0.4, max_tokens:400 })
      });
      var data = await res.json();
      if (data.error) throw new Error(data.error.message);
      var txt = data.choices[0].message.content;
      var g = function(k){ var m = txt.match(new RegExp(k+':\\s*(.+)')); return m ? m[1].trim() : '—'; };
      estim.tournage = g('ESTIMATION_TOURNAGE');
      estim.postprod = g('ESTIMATION_POSTPROD');
      estim.total = g('TOTAL_ESTIME');
      estim.complexite = g('COMPLEXITE');
      estim.verdict = g('VERDICT');
      estim.analyse = g('ANALYSE_BUDGET');
      estim.reco = g('RECOMMANDATION');
    } catch(e) {
      estim.analyse = 'Erreur IA : ' + e.message;
    }

    // Classe verdict pour le template
    var verdictClass = estim.verdict === 'honnete' ? 'ok' : (estim.verdict === 'trop_bas' ? 'low' : 'meh');
    var verdictTag = estim.verdict === 'honnete' ? 'Budget honnete' : (estim.verdict === 'trop_bas' ? 'Budget trop bas' : 'Budget correct');

    btn.textContent = 'Envoi...';
    try {
      await emailjs.send('service_drxsh2d', 'template_lx0ilon', {
        ref: REF,
        date: new Date().toLocaleDateString('fr-FR'),
        client_nom: brief.nom||'—',
        client_email: brief.email||'—',
        client_telephone: brief.telephone||'—',
        client_societe: brief.societe||'Particulier',
        projet_description: brief.projet||'—',
        projet_type: brief.type_presta||'—',
        projet_details_tournage: brief.details_tournage||'—',
        projet_lieu: brief.lieu||'—',
        projet_nb_jours: brief.nb_jours||'—',
        projet_sous_prestations: brief.sous_prestations||'—',
        projet_format_source: brief.format_source||'—',
        projet_ratio: brief.ratio||'—',
        projet_qualite: brief.qualite||'—',
        projet_diffusion: brief.diffusion||'—',
        projet_duree: brief.duree||'—',
        projet_deadline: brief.deadline||'—',
        projet_budget: brief.budget||'—',
        projet_refs: brief.refs||'—',
        projet_extra: brief.extra||'—',
        estim_tournage: estim.tournage,
        estim_postprod: estim.postprod,
        estim_total: estim.total,
        estim_complexite: estim.complexite,
        estim_recommandation: estim.reco,
        verdict_class: verdictClass,
        verdict_tag: verdictTag,
        verdict_analyse: estim.analyse
      });
      notify('Email envoye a Sofiane !');
    } catch(e) {
      notify('Erreur envoi : ' + (e.text||e.message));
    }
    btn.textContent = 'Envoyer a Sofiane';
    btn.disabled = false;
  };

  function notify(msg) {
    var n = document.getElementById('notif');
    n.textContent = msg; n.classList.add('show');
    setTimeout(function(){ n.classList.remove('show'); }, 4000);
  }

})();
</script>
</body>
</html>
